import Head from 'next/head'
import Image from 'next/image'
import styles from '../styles/Home.module.css'
import {useState} from "react";
import {MemoizedThread} from "../components/Thread";

export default function Home() {
  const [ipt, setIpt] = useState("");
  const [list, setList] = useState([]);

  function getWebsiteAndData(website) {
    const websiteReg = /\w+\.com/;
    const siteData = website.match(websiteReg);
    if (!Array.isArray(siteData)) return false;
    switch (siteData[0]) {
      case "ycombinator.com":
        // Grabs hackernews id query
        let id = siteData.input.match(/id=\d+/)[0].slice(3)
        return {site: siteData[0], id: id};
      case "reddit.com": // add reddit here
      default:
        return false;
    }
  }

  const handleForm = e => {
    e.preventDefault();
    let webData = getWebsiteAndData(ipt);
    if (webData) {
      setList([...list, webData])
      setIpt('')
    } else {
      alert('error')
    }
  }

  return (
    <div className={styles.container}>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className={styles.main}>
        <h1>Check Back Later</h1>
        <form onSubmit={handleForm}>
          <input value={ipt} onChange={e => setIpt(e.target.value)}/>
          <button>Add</button>
        </form>

        {list.length > 0 ?
          list.map((item, i) => (<MemoizedThread key={`${item}-${i}`} website={item.site} id={item.id}/>))
          :
          <p>No values</p>
        }
      </main>

    </div>
  )
}
